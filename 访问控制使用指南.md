# ğŸ” è®¿é—®æ§åˆ¶ä½¿ç”¨æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

è®¿é—®æ§åˆ¶åŠŸèƒ½ä¸ºä¸´æ—¶é‚®ç®±ç³»ç»Ÿæä¾›äº†ç®€å•è€Œæœ‰æ•ˆçš„å¯†ç ä¿æŠ¤ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚

### âœ¨ ç‰¹æ€§

- âœ… **å¯é€‰å¯ç”¨**ï¼šé»˜è®¤ä¸å¯ç”¨ï¼ŒæŒ‰éœ€é…ç½®
- âœ… **ç®€å•å¯†ç **ï¼šä½¿ç”¨å•ä¸€å¯†ç ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿ
- âœ… **ä»¤ç‰Œè®¤è¯**ï¼šåŸºäº Bearer Token çš„ HTTP è®¤è¯
- âœ… **æŒä¹…ç™»å½•**ï¼šä½¿ç”¨ localStorage ä¿å­˜ç™»å½•çŠ¶æ€
- âœ… **ä¼˜é›…ç•Œé¢**ï¼šç°ä»£åŒ–çš„ç™»å½•å¼¹çª—è®¾è®¡
- âœ… **è‡ªåŠ¨æ‹¦æˆª**ï¼šæœªç™»å½•æ—¶è‡ªåŠ¨æ˜¾ç¤ºç™»å½•ç•Œé¢

---

## ğŸš€ å¿«é€Ÿå¯ç”¨

### 1. é…ç½®è®¿é—®å¯†ç 

#### æ–¹æ³• Aï¼šç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ¨èï¼‰

**æœ¬åœ°å¼€å‘**ï¼š
```bash
# workers/.dev.vars
ACCESS_PASSWORD=your_secret_password_here
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆCloudflareï¼‰**ï¼š
```bash
# é€šè¿‡ wrangler è®¾ç½®
npx wrangler secret put ACCESS_PASSWORD

# æˆ–åœ¨ Cloudflare Dashboard ä¸­è®¾ç½®
# Workers & Pages â†’ Your Worker â†’ Settings â†’ Variables
```

#### æ–¹æ³• Bï¼šwrangler.toml é…ç½®

```toml
# workers/wrangler.toml
[vars]
ACCESS_PASSWORD = "your_password"  # ä¸æ¨èåœ¨ä»£ç ä¸­æ˜æ–‡å­˜å‚¨
```

âš ï¸ **å®‰å…¨æç¤º**ï¼š
- ä¸è¦åœ¨ `wrangler.toml` ä¸­è®¾ç½®å¯†ç ï¼ˆä¼šè¢«æäº¤åˆ° Gitï¼‰
- ä½¿ç”¨ `wrangler secret` æˆ– Cloudflare Dashboard è®¾ç½®
- ä½¿ç”¨å¼ºå¯†ç ï¼ˆå»ºè®® 12+ ä½ï¼ŒåŒ…å«å­—æ¯ã€æ•°å­—ã€ç¬¦å·ï¼‰

### 2. é‡å¯æœåŠ¡

```bash
# æœ¬åœ°å¼€å‘
cd workers
npm run dev

# ç”Ÿäº§éƒ¨ç½²
npm run deploy
```

### 3. è®¿é—®ç³»ç»Ÿ

æ‰“å¼€å‰ç«¯é¡µé¢ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹è®¿é—®æ§åˆ¶æ˜¯å¦å¯ç”¨ã€‚

- **å¦‚æœå¯ç”¨**ï¼šæ˜¾ç¤ºç™»å½•å¼¹çª—
- **å¦‚æœæœªå¯ç”¨**ï¼šç›´æ¥è¿›å…¥ç³»ç»Ÿ

---

## ğŸ”§ å·¥ä½œåŸç†

### æ¶æ„æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯è®¿é—®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥è®¤è¯çŠ¶æ€     â”‚
â”‚ /api/auth/checkâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ å·²å¯ç”¨ï¼Ÿ â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚          â”‚
   æ˜¯          å¦
    â”‚          â”‚
    â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”
â”‚ç™»å½•  â”‚    â”‚ç›´æ¥ â”‚
â”‚å¼¹çª—  â”‚    â”‚è¿›å…¥ â”‚
â””â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥å¯†ç      â”‚
â”‚ POST /login  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–ä»¤ç‰Œ     â”‚
â”‚ å­˜å‚¨åˆ°æœ¬åœ°   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰€æœ‰APIè¯·æ±‚  â”‚
â”‚ æºå¸¦Token    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¤è¯æµç¨‹

1. **æ£€æŸ¥çŠ¶æ€**ï¼šå‰ç«¯å¯åŠ¨æ—¶è°ƒç”¨ `/api/auth/check` æ£€æŸ¥æ˜¯å¦å¯ç”¨
2. **ç™»å½•**ï¼šç”¨æˆ·è¾“å…¥å¯†ç ï¼Œè°ƒç”¨ `/api/auth/login` è·å–ä»¤ç‰Œ
3. **å­˜å‚¨ä»¤ç‰Œ**ï¼šä»¤ç‰Œä¿å­˜åˆ° `localStorage`
4. **APIè¯·æ±‚**ï¼šæ‰€æœ‰åç»­è¯·æ±‚åœ¨ Header ä¸­æºå¸¦ `Authorization: Bearer {token}`
5. **åç«¯éªŒè¯**ï¼šåç«¯ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯æ¯ä¸ªè¯·æ±‚çš„ä»¤ç‰Œ

---

## ğŸ“¡ API æ¥å£

### 1. æ£€æŸ¥è®¤è¯çŠ¶æ€

```http
GET /api/auth/check

Response:
{
  "success": true,
  "data": {
    "enabled": true,
    "message": "è®¿é—®æ§åˆ¶å·²å¯ç”¨"
  }
}
```

### 2. ç™»å½•

```http
POST /api/auth/login
Content-Type: application/json

{
  "password": "your_password"
}

Response (æˆåŠŸ):
{
  "success": true,
  "data": {
    "token": "your_password",
    "expiresIn": 86400,
    "message": "ç™»å½•æˆåŠŸ"
  }
}

Response (å¤±è´¥):
{
  "success": false,
  "error": "å¯†ç é”™è¯¯"
}
```

### 3. éªŒè¯ä»¤ç‰Œ

```http
POST /api/auth/verify
Content-Type: application/json

{
  "token": "your_token"
}

Response:
{
  "success": true,
  "data": {
    "valid": true,
    "message": "ä»¤ç‰Œæœ‰æ•ˆ"
  }
}
```

### 4. ç™»å‡º

```http
POST /api/auth/logout

Response:
{
  "success": true,
  "data": {
    "message": "ç™»å‡ºæˆåŠŸ"
  }
}
```

---

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

### 1. å…¬å¼€è·¯å¾„

ä»¥ä¸‹è·¯å¾„æ— éœ€è®¤è¯å³å¯è®¿é—®ï¼š

- `/` - é¦–é¡µ
- `/health` - å¥åº·æ£€æŸ¥
- `/api/auth/check` - è®¤è¯çŠ¶æ€æ£€æŸ¥
- `/api/auth/login` - ç™»å½•æ¥å£
- `/ws` - WebSocketï¼ˆéœ€å•ç‹¬éªŒè¯ï¼‰

### 2. å—ä¿æŠ¤è·¯å¾„

æ‰€æœ‰å…¶ä»– API è·¯å¾„éƒ½éœ€è¦è®¤è¯ï¼š

- `/api/emails/*` - é‚®ç®±ç®¡ç†
- `/api/messages/*` - é‚®ä»¶ç®¡ç†
- `/api/monitor/*` - ç›‘æ§çŠ¶æ€
- `/api/config/*` - ç³»ç»Ÿé…ç½®

### 3. è¯·æ±‚æ ¼å¼

æ‰€æœ‰å—ä¿æŠ¤çš„è¯·æ±‚å¿…é¡»æºå¸¦è®¤è¯å¤´ï¼š

```http
GET /api/emails
Authorization: Bearer your_token_here
```

### 4. é”™è¯¯å“åº”

æœªè®¤è¯æˆ–è®¤è¯å¤±è´¥æ—¶è¿”å›ï¼š

```http
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm="Temp Email System"

{
  "success": false,
  "error": "Unauthorized"
}
```

---

## ğŸ’» å‰ç«¯é›†æˆ

### ä½¿ç”¨ authStore

```javascript
import { useAuthStore } from '@/stores/authStore'

const authStore = useAuthStore()

// æ£€æŸ¥æ˜¯å¦å¯ç”¨
const enabled = await authStore.checkAuthStatus()

// ç™»å½•
try {
  await authStore.login('password')
  console.log('ç™»å½•æˆåŠŸ')
} catch (error) {
  console.error('ç™»å½•å¤±è´¥:', error.message)
}

// ç™»å‡º
await authStore.logout()

// æ£€æŸ¥ç™»å½•çŠ¶æ€
console.log('å·²ç™»å½•:', authStore.isAuthenticated)
```

### Axios æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†

æ‰€æœ‰ axios è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ä»¤ç‰Œï¼š

```javascript
// authStore.initAuth() ä¼šè®¾ç½®é»˜è®¤ header
axios.defaults.headers.common['Authorization'] = `Bearer ${token}`

// æ‰€æœ‰è¯·æ±‚è‡ªåŠ¨æºå¸¦
await axios.get('/api/emails')  // âœ… è‡ªåŠ¨å¸¦ Authorization header
```

---

## ğŸ¨ UI ç»„ä»¶

### LoginModal ç»„ä»¶

```vue
<LoginModal 
  :visible="showLogin" 
  @close="showLogin = false"
  @success="onLoginSuccess"
/>
```

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- âœ… å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
- âœ… åŠ è½½çŠ¶æ€æŒ‡ç¤º
- âœ… é”™è¯¯æ¶ˆæ¯æç¤º
- âœ… å›è½¦é”®æäº¤
- âœ… è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
- âœ… é”®ç›˜å¯¼èˆªæ”¯æŒ

---

## ğŸ”„ ç¦ç”¨è®¿é—®æ§åˆ¶

### æ–¹æ³• 1ï¼šåˆ é™¤ç¯å¢ƒå˜é‡

```bash
# åˆ é™¤ .dev.vars ä¸­çš„ ACCESS_PASSWORD
# æˆ–è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²
ACCESS_PASSWORD=
```

### æ–¹æ³• 2ï¼šCloudflare Dashboard

1. è¿›å…¥ Workers & Pages
2. é€‰æ‹©æ‚¨çš„ Worker
3. Settings â†’ Variables
4. åˆ é™¤ `ACCESS_PASSWORD` å˜é‡

### æ–¹æ³• 3ï¼šwrangler secret

```bash
# åˆ é™¤ secret
npx wrangler secret delete ACCESS_PASSWORD
```

é‡å¯æœåŠ¡åï¼Œç³»ç»Ÿå°†ä¸å†è¦æ±‚ç™»å½•ã€‚

---

## ğŸ“Š ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šä¸ªäººä½¿ç”¨ï¼ˆæ¨èä¸å¯ç”¨ï¼‰

å¦‚æœåªæ˜¯ä¸ªäººä½¿ç”¨ï¼Œå¯ä»¥ä¸å¯ç”¨è®¿é—®æ§åˆ¶ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿æŠ¤ï¼š

- âœ… ä½¿ç”¨é˜²ç«å¢™é™åˆ¶ IP è®¿é—®
- âœ… ä½¿ç”¨ Cloudflare Access
- âœ… VPN è®¿é—®

### åœºæ™¯ 2ï¼šå›¢é˜Ÿå…±äº«ï¼ˆæ¨èå¯ç”¨ï¼‰

å¤šäººå…±äº«æ—¶å¯ç”¨è®¿é—®æ§åˆ¶ï¼š

```bash
ACCESS_PASSWORD=team_shared_password_2024
```

### åœºæ™¯ 3ï¼šå…¬å¼€æ¼”ç¤ºï¼ˆå¿…é¡»å¯ç”¨ï¼‰

å…¬å¼€å±•ç¤ºæ—¶å¿…é¡»å¯ç”¨ï¼š

```bash
ACCESS_PASSWORD=demo_access_password_2024
```

---

## âš ï¸ é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

### å½“å‰é™åˆ¶

1. **å•ä¸€å¯†ç **ï¼šæ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€å¯†ç 
2. **æ— è§’è‰²æƒé™**ï¼šæ‰€æœ‰ç™»å½•ç”¨æˆ·æƒé™ç›¸åŒ
3. **ç®€å•ä»¤ç‰Œ**ï¼šä»¤ç‰Œå°±æ˜¯å¯†ç æœ¬èº«ï¼ˆæœªåŠ å¯†ï¼‰
4. **æ— è¿‡æœŸæœºåˆ¶**ï¼šä»¤ç‰Œä¸ä¼šè‡ªåŠ¨è¿‡æœŸ

### å®‰å…¨å»ºè®®

1. âœ… ä½¿ç”¨å¼ºå¯†ç ï¼ˆ12+ ä½ï¼‰
2. âœ… å®šæœŸæ›´æ¢å¯†ç 
3. âœ… ä¸è¦åœ¨å…¬å¼€åœºåˆå±•ç¤ºå¯†ç 
4. âœ… ä½¿ç”¨ HTTPS è®¿é—®
5. âœ… ç»“åˆ Cloudflare é˜²ç«å¢™è§„åˆ™

### æœªæ¥æ”¹è¿›

è®¡åˆ’åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æ·»åŠ ï¼š

- ğŸ”œ JWT ä»¤ç‰ŒåŠ å¯†
- ğŸ”œ ä»¤ç‰Œè‡ªåŠ¨è¿‡æœŸ
- ğŸ”œ å¤šç”¨æˆ·è§’è‰²
- ğŸ”œ ç™»å½•æ—¥å¿—
- ğŸ”œ IP ç™½åå•
- ğŸ”œ ä¸¤æ­¥éªŒè¯

---

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•å¯ç”¨çŠ¶æ€

```bash
curl http://localhost:8787/api/auth/check
```

### æµ‹è¯•ç™»å½•

```bash
curl -X POST http://localhost:8787/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"password":"your_password"}'
```

### æµ‹è¯•å—ä¿æŠ¤æ¥å£

```bash
# æœªè®¤è¯ï¼ˆåº”è¿”å› 401ï¼‰
curl http://localhost:8787/api/emails

# å·²è®¤è¯ï¼ˆåº”è¿”å›æ•°æ®ï¼‰
curl http://localhost:8787/api/emails \
  -H "Authorization: Bearer your_password"
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šç™»å½•åä»æç¤ºæœªæˆæƒ

**åŸå› **ï¼šä»¤ç‰Œæœªæ­£ç¡®è®¾ç½®åˆ°è¯·æ±‚å¤´

**è§£å†³**ï¼š
1. æ£€æŸ¥ `localStorage` ä¸­æ˜¯å¦å­˜åœ¨ `auth_token`
2. åˆ·æ–°é¡µé¢é‡æ–°ç™»å½•
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### é—®é¢˜ 2ï¼šå¯†ç æ­£ç¡®ä½†æ— æ³•ç™»å½•

**åŸå› **ï¼šåç«¯å¯†ç é…ç½®ä¸æ­£ç¡®

**è§£å†³**ï¼š
1. æ£€æŸ¥ `.dev.vars` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥ `ACCESS_PASSWORD` æ˜¯å¦æ­£ç¡®è®¾ç½®
3. é‡å¯ Workers æœåŠ¡

### é—®é¢˜ 3ï¼šéƒ¨ç½²åè®¿é—®æ§åˆ¶æœªç”Ÿæ•ˆ

**åŸå› **ï¼šç¯å¢ƒå˜é‡æœªéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨ wrangler secret è®¾ç½®
npx wrangler secret put ACCESS_PASSWORD

# æˆ–åœ¨ Cloudflare Dashboard è®¾ç½®
```

---

## ğŸ“ é…ç½®ç¤ºä¾‹

### å®Œæ•´é…ç½®æ–‡ä»¶

```bash
# workers/.dev.vars

# Cloudflare API é…ç½®
CLOUDFLARE_API_TOKEN=your_token
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_ZONE_ID=your_zone_id

# åŸŸåé…ç½®
DOMAIN_NAME=yourdomain.com
TARGET_EMAIL=your@qq.com

# è®¿é—®æ§åˆ¶ï¼ˆå¼ºå¯†ç ç¤ºä¾‹ï¼‰
ACCESS_PASSWORD=TempEmail@2024!SecurePassword
```

### ç”Ÿäº§ç¯å¢ƒè®¾ç½®

```bash
# 1. è®¾ç½®å¯†ç 
npx wrangler secret put ACCESS_PASSWORD
# è¾“å…¥ï¼šTempEmail@2024!SecurePassword

# 2. éƒ¨ç½²
npx wrangler deploy

# 3. éªŒè¯
curl https://your-worker.workers.dev/api/auth/check
```

---

## âœ… æœ€ä½³å®è·µ

1. **å¯†ç ç®¡ç†**
   - ä½¿ç”¨å¯†ç ç®¡ç†å™¨ç”Ÿæˆå’Œå­˜å‚¨
   - å®šæœŸæ›´æ¢ï¼ˆå»ºè®®æ¯ 3 ä¸ªæœˆï¼‰
   - ä¸è¦åœ¨ä»£ç ä»“åº“ä¸­å­˜å‚¨

2. **è®¿é—®æ§åˆ¶**
   - ä¸ªäººä½¿ç”¨å¯ä¸å¯ç”¨
   - å›¢é˜Ÿå…±äº«å»ºè®®å¯ç”¨
   - å…¬å¼€ç¯å¢ƒå¿…é¡»å¯ç”¨

3. **å®‰å…¨åŠ å›º**
   - å¯ç”¨ HTTPS
   - é…ç½® Cloudflare é˜²ç«å¢™
   - è®¾ç½® IP ç™½åå•
   - å¯ç”¨ Bot é˜²æŠ¤

4. **ç›‘æ§æ—¥å¿—**
   - æ£€æŸ¥ Cloudflare Workers æ—¥å¿—
   - ç›‘æ§å¼‚å¸¸ç™»å½•å°è¯•
   - å®šæœŸå®¡æŸ¥è®¿é—®è®°å½•

---

## ğŸ‰ æ€»ç»“

è®¿é—®æ§åˆ¶åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œæä¾›äº†ï¼š

- âœ… å®Œæ•´çš„å‰åç«¯è®¤è¯æµç¨‹
- âœ… ä¼˜é›…çš„ç”¨æˆ·ç•Œé¢
- âœ… çµæ´»çš„é…ç½®é€‰é¡¹
- âœ… è‰¯å¥½çš„å®‰å…¨æœºåˆ¶

**å¼€å§‹ä½¿ç”¨**ï¼š
1. è®¾ç½® `ACCESS_PASSWORD` ç¯å¢ƒå˜é‡
2. é‡å¯æœåŠ¡
3. æ‰“å¼€å‰ç«¯ï¼Œè¾“å…¥å¯†ç ç™»å½•

**è·å–å¸®åŠ©**ï¼š
- æŸ¥çœ‹æ–‡æ¡£ï¼š`README.md`
- æŸ¥çœ‹ç¤ºä¾‹ï¼š`workers/env.example`
- æ£€æŸ¥æ—¥å¿—ï¼šCloudflare Dashboard

