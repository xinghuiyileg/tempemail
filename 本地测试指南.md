# ğŸ§ª æœ¬åœ°æµ‹è¯•æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

ç¡®ä¿å·²å®‰è£…ï¼š
- âœ… Node.js 18+ï¼ˆæ¨è 20+ï¼‰
- âœ… npm æˆ– yarn
- âœ… Git

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ5åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd E:\æ¡Œé¢\tempemail

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install

# å®‰è£… Workers ä¾èµ–
cd ../workers
npm install
```

### æ­¥éª¤ 2ï¼šé…ç½®æœ¬åœ°ç¯å¢ƒå˜é‡

#### é…ç½® Workers ç¯å¢ƒå˜é‡

åˆ›å»º `workers/.dev.vars` æ–‡ä»¶ï¼š

```bash
cd workers
```

åˆ›å»ºæ–‡ä»¶å†…å®¹ï¼š
```env
# Cloudflare é…ç½®ï¼ˆæš‚æ—¶å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿå€¼ï¼Œæœ¬åœ°æµ‹è¯•ä¸éœ€è¦çœŸå®çš„ï¼‰
CLOUDFLARE_API_TOKEN=test_token_for_local
CLOUDFLARE_ACCOUNT_ID=test_account_id
CLOUDFLARE_ZONE_ID=test_zone_id

# åŸŸåé…ç½®
DOMAIN_NAME=test.local

# ç›®æ ‡é‚®ç®±
TARGET_EMAIL=test@qq.com
```

#### é…ç½®å‰ç«¯ç¯å¢ƒå˜é‡

åˆ›å»º `frontend/.env` æ–‡ä»¶ï¼š

```bash
cd ../frontend
```

åˆ›å»ºæ–‡ä»¶å†…å®¹ï¼š
```env
VITE_API_BASE=http://localhost:8787/api
VITE_WS_URL=ws://localhost:8787/ws
```

### æ­¥éª¤ 3ï¼šåˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“

```bash
cd ../workers

# æ–¹å¼ä¸€ï¼šä½¿ç”¨ Cloudflare D1ï¼ˆæ¨èï¼‰
npx wrangler d1 create tempemail-dev

# å°†è¾“å‡ºçš„ database_id å¤åˆ¶åˆ° wrangler.toml

# åˆå§‹åŒ–æ•°æ®åº“ç»“æ„
npx wrangler d1 execute tempemail-dev --file=schema.sql --local
```

å¦‚æœ Cloudflare D1 ä¸å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ° SQLiteï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰ã€‚

### æ­¥éª¤ 4ï¼šå¯åŠ¨æœåŠ¡

#### å¯åŠ¨ Workersï¼ˆç»ˆç«¯ 1ï¼‰

```bash
cd workers
npm run dev
```

åº”è¯¥çœ‹åˆ°ï¼š
```
â›…ï¸ wrangler 3.x.x
-------------------
â” Starting local server...
[wrangler:inf] Ready on http://localhost:8787
```

#### å¯åŠ¨å‰ç«¯ï¼ˆç»ˆç«¯ 2ï¼‰

```bash
cd frontend
npm run dev
```

åº”è¯¥çœ‹åˆ°ï¼š
```
VITE v5.x.x  ready in xxx ms

âœ  Local:   http://localhost:5173/
âœ  Network: use --host to expose
```

### æ­¥éª¤ 5ï¼šè®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173

---

## ğŸ§ª æœ¬åœ°æµ‹è¯•åŠŸèƒ½

### æµ‹è¯• 1ï¼šå‰ç«¯ç•Œé¢

âœ… **æ£€æŸ¥é¡¹**ï¼š
- [ ] é¡µé¢æ­£å¸¸åŠ è½½
- [ ] ç•Œé¢æ˜¾ç¤ºå®Œæ•´
- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸

### æµ‹è¯• 2ï¼šAPI è¿æ¥

âœ… **æµ‹è¯•æ­¥éª¤**ï¼š

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. è®¿é—® http://localhost:5173
3. æŸ¥çœ‹ Network æ ‡ç­¾
4. åº”è¯¥èƒ½çœ‹åˆ°å¯¹ `/api/config` çš„è¯·æ±‚

âœ… **éªŒè¯**ï¼š
```bash
# ç›´æ¥æµ‹è¯• API
curl http://localhost:8787/api/config
```

åº”è¯¥è¿”å› JSON å“åº”ã€‚

### æµ‹è¯• 3ï¼šåˆ›å»ºä¸´æ—¶é‚®ç®±ï¼ˆæ¨¡æ‹Ÿï¼‰

ç”±äºæœ¬åœ°ç¯å¢ƒæ²¡æœ‰ Cloudflare Email Routingï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼š

1. ç‚¹å‡»"ç”Ÿæˆé‚®ç®±"æŒ‰é’®
2. åº”è¯¥ç”Ÿæˆç±»ä¼¼ `temp_abc123@test.local` çš„é‚®ç®±
3. é‚®ç®±åœ°å€ä¼šä¿å­˜åˆ°æ•°æ®åº“
4. ç•Œé¢åº”è¯¥æ˜¾ç¤ºæ–°åˆ›å»ºçš„é‚®ç®±

âš ï¸ **æ³¨æ„**ï¼šæœ¬åœ°ç¯å¢ƒä¸‹ï¼ŒCloudflare API è°ƒç”¨ä¼šå¤±è´¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚

### æµ‹è¯• 4ï¼šæŸ¥çœ‹é‚®ç®±åˆ—è¡¨

1. åˆ›å»ºå‡ ä¸ªä¸´æ—¶é‚®ç®±
2. åœ¨"ä¸´æ—¶é‚®ç®±åˆ—è¡¨"ä¸­åº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰é‚®ç®±
3. æ˜¾ç¤ºåˆ›å»ºæ—¶é—´
4. ç‚¹å‡»é‚®ç®±å¯ä»¥é€‰ä¸­

### æµ‹è¯• 5ï¼šæ•°æ®åº“æ“ä½œ

```bash
cd workers

# æŸ¥çœ‹æ‰€æœ‰é‚®ç®±
npx wrangler d1 execute tempemail-dev --local --command="SELECT * FROM temp_emails"

# æŸ¥çœ‹é‚®ä»¶
npx wrangler d1 execute tempemail-dev --local --command="SELECT * FROM messages"

# æŸ¥çœ‹é…ç½®
npx wrangler d1 execute tempemail-dev --local --command="SELECT * FROM config"
```

### æµ‹è¯• 6ï¼šåˆ é™¤é‚®ç®±

1. ç‚¹å‡»é‚®ç®±é¡¹å³ä¾§çš„åˆ é™¤æŒ‰é’®
2. ç¡®è®¤åˆ é™¤
3. é‚®ç®±åº”è¯¥ä»åˆ—è¡¨ä¸­æ¶ˆå¤±
4. æ•°æ®åº“ä¸­çš„è®°å½•ä¹Ÿåº”è¯¥è¢«åˆ é™¤

---

## ğŸ”§ æœ¬åœ°å¼€å‘æ¨¡å¼åŠŸèƒ½é™åˆ¶

ç”±äºæœ¬åœ°ç¯å¢ƒé™åˆ¶ï¼Œä»¥ä¸‹åŠŸèƒ½éœ€è¦éƒ¨ç½²åæ‰èƒ½å®Œæ•´æµ‹è¯•ï¼š

### âŒ ä¸å¯ç”¨åŠŸèƒ½

1. **Cloudflare Email Routing**
   - æœ¬åœ°æ— æ³•åˆ›å»ºçœŸå®çš„è½¬å‘è§„åˆ™
   - API è°ƒç”¨ä¼šå¤±è´¥ï¼ˆä½†ä¸å½±å“å…¶ä»–åŠŸèƒ½ï¼‰

2. **é‚®ä»¶æ¥æ”¶**
   - Email Worker éœ€è¦éƒ¨ç½²åˆ° Cloudflare
   - æœ¬åœ°æ— æ³•æ¥æ”¶çœŸå®é‚®ä»¶

3. **WebSocket å®æ—¶æ¨é€**
   - æœ¬åœ° WebSocket è¿æ¥å¯èƒ½ä¸ç¨³å®š
   - éœ€è¦ä½¿ç”¨åˆ·æ–°æŒ‰é’®æ‰‹åŠ¨åˆ·æ–°

### âœ… å¯ç”¨åŠŸèƒ½

1. **å‰ç«¯ç•Œé¢**
   - å®Œæ•´çš„ UI å±•ç¤º
   - æ‰€æœ‰ç»„ä»¶æ­£å¸¸å·¥ä½œ
   - å“åº”å¼è®¾è®¡æµ‹è¯•

2. **API è°ƒç”¨**
   - CRUD æ“ä½œ
   - æ•°æ®åº“è¯»å†™
   - çŠ¶æ€ç®¡ç†

3. **æ•°æ®æŒä¹…åŒ–**
   - é‚®ç®±åˆ›å»ºå’Œåˆ é™¤
   - æ•°æ®å­˜å‚¨åˆ° D1
   - é…ç½®ç®¡ç†

---

## ğŸ¯ æ¨¡æ‹Ÿé‚®ä»¶æ•°æ®æµ‹è¯•

å¦‚æœæƒ³æµ‹è¯•é‚®ä»¶æ˜¾ç¤ºåŠŸèƒ½ï¼Œå¯ä»¥æ‰‹åŠ¨æ’å…¥æ¨¡æ‹Ÿæ•°æ®ï¼š

### æ–¹æ³• 1ï¼šä½¿ç”¨ SQL æ’å…¥

```bash
cd workers

# æ’å…¥æ¨¡æ‹Ÿé‚®ç®±
npx wrangler d1 execute tempemail-dev --local --command="
INSERT INTO temp_emails (email, target_email, message_count) 
VALUES ('test@test.local', 'your@qq.com', 3)
"

# è·å–é‚®ç®± ID
npx wrangler d1 execute tempemail-dev --local --command="
SELECT id FROM temp_emails WHERE email='test@test.local'
"

# æ’å…¥æ¨¡æ‹Ÿé‚®ä»¶ï¼ˆå‡è®¾é‚®ç®± ID ä¸º 1ï¼‰
npx wrangler d1 execute tempemail-dev --local --command="
INSERT INTO messages (temp_email_id, sender, subject, body_text, verification_code, received_at) 
VALUES 
(1, 'noreply@github.com', 'éªŒè¯æ‚¨çš„é‚®ç®±', 'æ‚¨çš„éªŒè¯ç æ˜¯ï¼š123456', '123456', datetime('now')),
(1, 'no-reply@google.com', 'ç™»å½•éªŒè¯ç ', 'éªŒè¯ç ï¼š789012', '789012', datetime('now', '-1 hour')),
(1, 'service@amazon.com', 'è®¢å•ç¡®è®¤', 'æ‚¨çš„è®¢å•å·²ç¡®è®¤', NULL, datetime('now', '-2 hours'))
"
```

### æ–¹æ³• 2ï¼šåˆ›å»ºæµ‹è¯•è„šæœ¬

åˆ›å»º `workers/test-data.sql`ï¼š

```sql
-- æ¸…ç©ºæµ‹è¯•æ•°æ®
DELETE FROM messages;
DELETE FROM temp_emails;

-- æ’å…¥æµ‹è¯•é‚®ç®±
INSERT INTO temp_emails (email, target_email, message_count, status) VALUES
('temp_test001@test.local', 'test@qq.com', 3, 'active'),
('temp_test002@test.local', 'test@qq.com', 1, 'active');

-- æ’å…¥æµ‹è¯•é‚®ä»¶
INSERT INTO messages (temp_email_id, sender, subject, body_text, verification_code, received_at, is_read) VALUES
(1, 'noreply@github.com', 'æ¬¢è¿åŠ å…¥ GitHub', 'æ„Ÿè°¢æ‚¨æ³¨å†Œ GitHubã€‚æ‚¨çš„éªŒè¯ç æ˜¯ï¼š123456', '123456', datetime('now'), 0),
(1, 'security@google.com', 'Google å®‰å…¨éªŒè¯', 'æ‚¨çš„ Google éªŒè¯ç ï¼š789012', '789012', datetime('now', '-30 minutes'), 0),
(1, 'noreply@amazon.com', 'è®¢å•ç¡®è®¤', 'æ‚¨çš„è®¢å•å·²ç¡®è®¤ï¼Œè®¢å•å·ï¼šABC123', NULL, datetime('now', '-1 hour'), 1),
(2, 'hello@notion.so', 'Notion å·¥ä½œåŒºé‚€è¯·', 'æ‚¨è¢«é‚€è¯·åŠ å…¥å·¥ä½œåŒºï¼ŒéªŒè¯ç ï¼š456789', '456789', datetime('now', '-2 hours'), 0);
```

æ‰§è¡Œæµ‹è¯•æ•°æ®ï¼š
```bash
npx wrangler d1 execute tempemail-dev --local --file=test-data.sql
```

åˆ·æ–°å‰ç«¯é¡µé¢ï¼Œåº”è¯¥èƒ½çœ‹åˆ°æµ‹è¯•é‚®ä»¶äº†ï¼

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šWorkers å¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Cannot find module 'wrangler'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
cd workers
npm install wrangler --save-dev
```

### é—®é¢˜ 2ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Network Error
```

**æ£€æŸ¥**ï¼š
1. Workers æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆhttp://localhost:8787ï¼‰
2. å‰ç«¯ `.env` é…ç½®æ˜¯å¦æ­£ç¡®
3. ç«¯å£æ˜¯å¦è¢«å ç”¨

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8787
netstat -ano | findstr :5173

# ä¿®æ”¹ç«¯å£ï¼ˆå¦‚æœéœ€è¦ï¼‰
# ç¼–è¾‘ frontend/vite.config.js
server: {
  port: 5174  // æ”¹ä¸ºå…¶ä»–ç«¯å£
}
```

### é—®é¢˜ 3ï¼šæ•°æ®åº“é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
D1_ERROR: no such table: temp_emails
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
cd workers
# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
npx wrangler d1 execute tempemail-dev --local --file=schema.sql
```

### é—®é¢˜ 4ï¼šCORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Access to XMLHttpRequest blocked by CORS policy
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
å·²åœ¨ `workers/src/utils/cors.js` ä¸­é…ç½®ï¼Œå¦‚æœä»æœ‰é—®é¢˜ï¼š
```javascript
// æ£€æŸ¥ corsHeaders é…ç½®
export const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
}
```

### é—®é¢˜ 5ï¼šWebSocket è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
WebSocket connection failed
```

**è¯´æ˜**ï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒçš„ WebSocket å¯èƒ½ä¸ç¨³å®šï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚

**æ›¿ä»£æ–¹æ¡ˆ**ï¼šä½¿ç”¨åˆ·æ–°æŒ‰é’®æ‰‹åŠ¨åˆ·æ–°æ•°æ®ã€‚

---

## ğŸ“Š æœ¬åœ°æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŸºç¡€åŠŸèƒ½
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½
- [ ] Workers API æ­£å¸¸å“åº”
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

### é‚®ç®±ç®¡ç†
- [ ] ç”Ÿæˆä¸´æ—¶é‚®ç®±
- [ ] é‚®ç®±åˆ—è¡¨æ˜¾ç¤º
- [ ] åˆ é™¤å•ä¸ªé‚®ç®±
- [ ] æ‰¹é‡åˆ é™¤é‚®ç®±
- [ ] é‚®ç®±åœ°å€å¤åˆ¶

### é‚®ä»¶åŠŸèƒ½
- [ ] é‚®ä»¶åˆ—è¡¨æ˜¾ç¤ºï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
- [ ] é‚®ä»¶è¯¦æƒ…æŸ¥çœ‹
- [ ] éªŒè¯ç æå–å’Œæ˜¾ç¤º
- [ ] éªŒè¯ç å¤åˆ¶
- [ ] æœªè¯»/å·²è¯»çŠ¶æ€

### ç•Œé¢åŠŸèƒ½
- [ ] å“åº”å¼è®¾è®¡ï¼ˆç¼©æ”¾æµè§ˆå™¨çª—å£ï¼‰
- [ ] æ˜æš—ä¸»é¢˜åˆ‡æ¢ï¼ˆç³»ç»Ÿè®¾ç½®ï¼‰
- [ ] åŠ¨ç”»æ•ˆæœ
- [ ] é€šçŸ¥æç¤º
- [ ] åŠ è½½çŠ¶æ€

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹ Workers æ—¥å¿—

Workers æ§åˆ¶å°ä¼šæ˜¾ç¤ºæ‰€æœ‰è¯·æ±‚å’Œé”™è¯¯ï¼š
```bash
cd workers
npm run dev
# æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```

### 2. æµè§ˆå™¨å¼€å‘è€…å·¥å…·

- **Console**ï¼šæŸ¥çœ‹ JavaScript é”™è¯¯
- **Network**ï¼šæŸ¥çœ‹ API è¯·æ±‚å’Œå“åº”
- **Application**ï¼šæŸ¥çœ‹ LocalStorage

### 3. æ•°æ®åº“è°ƒè¯•

```bash
# æŸ¥çœ‹æ‰€æœ‰è¡¨
npx wrangler d1 execute tempemail-dev --local --command="
SELECT name FROM sqlite_master WHERE type='table'
"

# æŸ¥çœ‹è¡¨ç»“æ„
npx wrangler d1 execute tempemail-dev --local --command="
PRAGMA table_info(temp_emails)
"

# ç»Ÿè®¡æ•°æ®
npx wrangler d1 execute tempemail-dev --local --command="
SELECT 
  (SELECT COUNT(*) FROM temp_emails) as email_count,
  (SELECT COUNT(*) FROM messages) as message_count,
  (SELECT COUNT(*) FROM messages WHERE verification_code IS NOT NULL) as code_count
"
```

### 4. API æµ‹è¯•å·¥å…·

ä½¿ç”¨ curl æˆ– Postman æµ‹è¯• APIï¼š

```bash
# æµ‹è¯•åˆ›å»ºé‚®ç®±
curl -X POST http://localhost:8787/api/emails/create

# æµ‹è¯•è·å–é‚®ç®±åˆ—è¡¨
curl http://localhost:8787/api/emails/list

# æµ‹è¯•è·å–é…ç½®
curl http://localhost:8787/api/config

# æµ‹è¯•ç›‘æ§çŠ¶æ€
curl http://localhost:8787/api/monitor/status
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æœ¬åœ°æµ‹è¯•é€šè¿‡åï¼š

1. **é˜…è¯»éƒ¨ç½²æ–‡æ¡£**
   - [å¿«é€Ÿå¼€å§‹.md](./å¿«é€Ÿå¼€å§‹.md)
   - [ç¯å¢ƒé…ç½®å‘å¯¼.md](./ç¯å¢ƒé…ç½®å‘å¯¼.md)

2. **å‡†å¤‡éƒ¨ç½²ç¯å¢ƒ**
   - è·å– Cloudflare API Token
   - é…ç½® Email Routing
   - å‡†å¤‡ç”Ÿäº§ç¯å¢ƒé…ç½®

3. **éƒ¨ç½²åˆ°ç”Ÿäº§**
   ```bash
   ./deploy.sh
   ```

4. **æµ‹è¯•çœŸå®é‚®ä»¶**
   - ç”Ÿæˆä¸´æ—¶é‚®ç®±
   - å‘é€æµ‹è¯•é‚®ä»¶
   - éªŒè¯é‚®ä»¶æ¥æ”¶å’ŒéªŒè¯ç æå–

---

## ğŸ’¡ å¼€å‘æç¤º

### çƒ­é‡è½½

- **å‰ç«¯**ï¼šä¿®æ”¹ä»£ç è‡ªåŠ¨åˆ·æ–°
- **Workers**ï¼šä¿®æ”¹ä»£ç éœ€è¦é‡å¯ï¼ˆCtrl+C ç„¶åé‡æ–°è¿è¡Œï¼‰

### æ¨èçš„å¼€å‘æµç¨‹

1. å¯åŠ¨ Workersï¼ˆç»ˆç«¯ 1ï¼‰
2. å¯åŠ¨å‰ç«¯ï¼ˆç»ˆç«¯ 2ï¼‰
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
4. ä¿®æ”¹ä»£ç  â†’ æµ‹è¯• â†’ è°ƒè¯•
5. ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•é‚®ä»¶åŠŸèƒ½

### VS Code æ‰©å±•æ¨è

- **Vue Language Features (Volar)**ï¼šVue 3 æ”¯æŒ
- **ESLint**ï¼šä»£ç æ£€æŸ¥
- **Prettier**ï¼šä»£ç æ ¼å¼åŒ–
- **SQLite Viewer**ï¼šæŸ¥çœ‹ SQLite æ•°æ®åº“

---

ç¥æµ‹è¯•é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®Œæ•´æ–‡æ¡£æˆ–æäº¤ Issueã€‚ğŸš€

