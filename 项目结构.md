# ä¸´æ—¶é‚®ç®±ç³»ç»Ÿ - é¡¹ç›®ç»“æ„

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
tempemail/
â”œâ”€â”€ frontend/                          # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ assets/                   # é™æ€èµ„æº
â”‚   â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ main.css
â”‚   â”‚   â”‚   â””â”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ components/               # Vueç»„ä»¶ï¼ˆå¦‚æœä½¿ç”¨Vueï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ EmailGenerator.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ EmailList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ EmailItem.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageItem.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ MonitorStatus.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigPanel.vue
â”‚   â”‚   â”‚   â””â”€â”€ AdBanner.vue
â”‚   â”‚   â”œâ”€â”€ composables/              # Vueç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ useWebSocket.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useClipboard.js
â”‚   â”‚   â”‚   â””â”€â”€ useNotification.js
â”‚   â”‚   â”œâ”€â”€ services/                 # APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â”‚   â”œâ”€â”€ emailService.js
â”‚   â”‚   â”‚   â”œâ”€â”€ messageService.js
â”‚   â”‚   â”‚   â””â”€â”€ configService.js
â”‚   â”‚   â”œâ”€â”€ stores/                   # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ emailStore.js
â”‚   â”‚   â”‚   â”œâ”€â”€ messageStore.js
â”‚   â”‚   â”‚   â””â”€â”€ configStore.js
â”‚   â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ formatTime.js
â”‚   â”‚   â”‚   â”œâ”€â”€ extractCode.js
â”‚   â”‚   â”‚   â””â”€â”€ validators.js
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ backend/                          # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                      # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ email.js          # ä¸´æ—¶é‚®ç®±è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message.js        # é‚®ä»¶æ¶ˆæ¯è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config.js         # é…ç½®è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ monitor.js        # ç›‘æ§è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ cloudflare.js         # Cloudflare APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ emailMonitor.js       # é‚®ä»¶ç›‘æ§æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ imapClient.js         # IMAPå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ codeExtractor.js      # éªŒè¯ç æå–
â”‚   â”‚   â”‚   â””â”€â”€ websocket.js          # WebSocketæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ TempEmail.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Message.js
â”‚   â”‚   â”‚   â””â”€â”€ Config.js
â”‚   â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.sql            # æ•°æ®åº“ç»“æ„
â”‚   â”‚   â”‚   â”œâ”€â”€ migrations/           # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”‚   â””â”€â”€ db.js                 # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js               # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ rateLimit.js          # é™æµä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ errorHandler.js       # é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.js             # æ—¥å¿—
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto.js             # åŠ å¯†è§£å¯†
â”‚   â”‚   â”‚   â””â”€â”€ validator.js          # éªŒè¯å™¨
â”‚   â”‚   â”œâ”€â”€ config/                   # é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.js
â”‚   â”‚   â”‚   â”œâ”€â”€ cloudflare.js
â”‚   â”‚   â”‚   â””â”€â”€ imap.js
â”‚   â”‚   â””â”€â”€ app.js                    # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ tests/                        # æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ integration/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ database/                         # æ•°æ®åº“æ–‡ä»¶ï¼ˆSQLiteï¼‰
â”‚   â””â”€â”€ tempemail.db
â”‚
â”œâ”€â”€ docs/                             # æ–‡æ¡£
â”‚   â”œâ”€â”€ éœ€æ±‚åˆ†æ.md                   # éœ€æ±‚åˆ†ææ–‡æ¡£
â”‚   â”œâ”€â”€ é¡¹ç›®ç»“æ„.md                   # é¡¹ç›®ç»“æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ APIæ–‡æ¡£.md                    # APIæ¥å£æ–‡æ¡£
â”‚   â”œâ”€â”€ éƒ¨ç½²æŒ‡å—.md                   # éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ ä½¿ç”¨è¯´æ˜.md                   # ç”¨æˆ·ä½¿ç”¨è¯´æ˜
â”‚
â”œâ”€â”€ scripts/                          # è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh                      # åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh                     # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ cleanup.sh                    # æ¸…ç†è„šæœ¬
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ docker-compose.yml                # Dockeré…ç½®ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ”§ æ–¹æ¡ˆä¸€ï¼šçº¯JavaScriptç‰ˆæœ¬ï¼ˆæ— æ¡†æ¶ï¼‰

```
tempemail/
â”œâ”€â”€ index.html                        # ä¸»é¡µé¢
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css                     # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ main.js                       # ä¸»å…¥å£
â”‚   â”œâ”€â”€ api.js                        # APIå°è£…
â”‚   â”œâ”€â”€ websocket.js                  # WebSocketè¿æ¥
â”‚   â”œâ”€â”€ emailManager.js               # é‚®ç®±ç®¡ç†
â”‚   â”œâ”€â”€ messageManager.js             # é‚®ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ ui.js                         # UIæ“ä½œ
â”‚   â””â”€â”€ utils.js                      # å·¥å…·å‡½æ•°
â”œâ”€â”€ backend/                          # åç«¯ï¼ˆåŒä¸Šï¼‰
â””â”€â”€ ...
```

---

## ğŸ”§ æ–¹æ¡ˆäºŒï¼šCloudflare å…¨æ ˆç‰ˆæœ¬

```
tempemail/
â”œâ”€â”€ frontend/                         # å‰ç«¯ï¼ˆéƒ¨ç½²åˆ°Pagesï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ workers/                          # Cloudflare Workers
â”‚   â”œâ”€â”€ api/                          # API Workers
â”‚   â”‚   â”œâ”€â”€ email.js
â”‚   â”‚   â”œâ”€â”€ message.js
â”‚   â”‚   â””â”€â”€ config.js
â”‚   â”œâ”€â”€ monitor/                      # ç›‘æ§Workerï¼ˆCronè§¦å‘ï¼‰
â”‚   â”‚   â””â”€â”€ email-monitor.js
â”‚   â””â”€â”€ wrangler.toml                 # Workersé…ç½®
â”œâ”€â”€ d1/                               # Cloudflare D1æ•°æ®åº“
â”‚   â””â”€â”€ schema.sql
â””â”€â”€ ...
```

---

## ğŸ“¦ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

#### `src/services/api.js` - APIå°è£…
```javascript
import axios from 'axios';

const API_BASE = import.meta.env.VITE_API_BASE || '/api';

export const emailAPI = {
    create: () => axios.post(`${API_BASE}/emails/create`),
    list: () => axios.get(`${API_BASE}/emails/list`),
    delete: (id) => axios.delete(`${API_BASE}/emails/${id}`),
    batchDelete: (ids) => axios.post(`${API_BASE}/emails/batch-delete`, { ids })
};

export const messageAPI = {
    list: (emailId, page = 1) => axios.get(`${API_BASE}/emails/${emailId}/messages?page=${page}`),
    get: (id) => axios.get(`${API_BASE}/messages/${id}`)
};

export const configAPI = {
    get: () => axios.get(`${API_BASE}/config`),
    update: (data) => axios.put(`${API_BASE}/config`, data)
};

export const monitorAPI = {
    status: () => axios.get(`${API_BASE}/monitor/status`),
    toggle: (action) => axios.post(`${API_BASE}/monitor/toggle`, { action })
};
```

#### `src/composables/useWebSocket.js` - WebSocketè¿æ¥
```javascript
import { ref, onMounted, onUnmounted } from 'vue';

export function useWebSocket(url) {
    const ws = ref(null);
    const connected = ref(false);
    const messages = ref([]);
    
    const connect = () => {
        ws.value = new WebSocket(url);
        
        ws.value.onopen = () => {
            connected.value = true;
            console.log('WebSocket connected');
        };
        
        ws.value.onmessage = (event) => {
            const data = JSON.parse(event.data);
            messages.value.push(data);
            handleMessage(data);
        };
        
        ws.value.onerror = (error) => {
            console.error('WebSocket error:', error);
        };
        
        ws.value.onclose = () => {
            connected.value = false;
            console.log('WebSocket disconnected');
            // é‡è¿é€»è¾‘
            setTimeout(connect, 5000);
        };
    };
    
    const handleMessage = (data) => {
        if (data.type === 'new_email') {
            // è§¦å‘æ–°é‚®ä»¶é€šçŸ¥
            showNotification(data.data);
        }
    };
    
    const send = (data) => {
        if (ws.value && connected.value) {
            ws.value.send(JSON.stringify(data));
        }
    };
    
    onMounted(() => {
        connect();
    });
    
    onUnmounted(() => {
        if (ws.value) {
            ws.value.close();
        }
    });
    
    return {
        connected,
        messages,
        send
    };
}
```

### åç«¯æ ¸å¿ƒæ–‡ä»¶

#### `src/services/cloudflare.js` - Cloudflare API
```javascript
class CloudflareService {
    constructor(apiToken, accountId, zoneId) {
        this.apiToken = apiToken;
        this.accountId = accountId;
        this.zoneId = zoneId;
        this.baseURL = 'https://api.cloudflare.com/client/v4';
    }
    
    async createEmailRule(emailAddress, targetEmail) {
        const response = await fetch(
            `${this.baseURL}/zones/${this.zoneId}/email/routing/rules`,
            {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${this.apiToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    matchers: [{
                        type: 'literal',
                        field: 'to',
                        value: emailAddress
                    }],
                    actions: [{
                        type: 'forward',
                        value: [targetEmail]
                    }],
                    enabled: true,
                    name: `Temp: ${emailAddress}`
                })
            }
        );
        
        return await response.json();
    }
    
    async deleteEmailRule(ruleId) {
        const response = await fetch(
            `${this.baseURL}/zones/${this.zoneId}/email/routing/rules/${ruleId}`,
            {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${this.apiToken}`
                }
            }
        );
        
        return await response.json();
    }
    
    async listEmailRules() {
        const response = await fetch(
            `${this.baseURL}/zones/${this.zoneId}/email/routing/rules`,
            {
                headers: {
                    'Authorization': `Bearer ${this.apiToken}`
                }
            }
        );
        
        return await response.json();
    }
}

module.exports = CloudflareService;
```

#### `src/services/emailMonitor.js` - é‚®ä»¶ç›‘æ§
```javascript
const Imap = require('node-imap');
const { simpleParser } = require('mailparser');
const { extractVerificationCode } = require('./codeExtractor');
const { Message } = require('../models/Message');

class EmailMonitor {
    constructor(config, websocketServer) {
        this.config = config;
        this.ws = websocketServer;
        this.imap = null;
        this.isRunning = false;
        this.processedMessageIds = new Set();
    }
    
    start() {
        this.imap = new Imap({
            user: this.config.user,
            password: this.config.password,
            host: this.config.host,
            port: this.config.port,
            tls: true,
            tlsOptions: { rejectUnauthorized: false }
        });
        
        this.imap.once('ready', () => {
            this.isRunning = true;
            this.monitor();
        });
        
        this.imap.once('error', (err) => {
            console.error('IMAP Error:', err);
            this.isRunning = false;
        });
        
        this.imap.connect();
    }
    
    async monitor() {
        this.imap.openBox('INBOX', false, (err, box) => {
            if (err) throw err;
            
            // ç›‘å¬æ–°é‚®ä»¶
            this.imap.on('mail', (numNewMail) => {
                this.fetchNewMessages();
            });
            
            // é¦–æ¬¡è·å–æœ€è¿‘çš„é‚®ä»¶
            this.fetchNewMessages();
        });
    }
    
    async fetchNewMessages() {
        const sinceDate = new Date(Date.now() - 3600000); // æœ€è¿‘1å°æ—¶
        
        this.imap.search([['SINCE', sinceDate]], (err, results) => {
            if (err) throw err;
            if (results.length === 0) return;
            
            const f = this.imap.fetch(results, {
                bodies: '',
                struct: true
            });
            
            f.on('message', (msg, seqno) => {
                let messageId = null;
                
                msg.on('body', (stream, info) => {
                    simpleParser(stream, async (err, parsed) => {
                        if (err) throw err;
                        
                        messageId = parsed.messageId;
                        
                        // é¿å…é‡å¤å¤„ç†
                        if (this.processedMessageIds.has(messageId)) {
                            return;
                        }
                        
                        this.processedMessageIds.add(messageId);
                        
                        // æå–éªŒè¯ç 
                        const code = extractVerificationCode(parsed.text || parsed.html);
                        
                        // ä¿å­˜åˆ°æ•°æ®åº“
                        const message = await Message.create({
                            messageId,
                            sender: parsed.from.text,
                            subject: parsed.subject,
                            bodyText: parsed.text,
                            bodyHtml: parsed.html,
                            verificationCode: code,
                            receivedAt: parsed.date
                        });
                        
                        // é€šè¿‡WebSocketæ¨é€åˆ°å‰ç«¯
                        this.ws.broadcast({
                            type: 'new_email',
                            data: message
                        });
                    });
                });
            });
        });
    }
    
    stop() {
        if (this.imap) {
            this.imap.end();
            this.isRunning = false;
        }
    }
}

module.exports = EmailMonitor;
```

#### `src/services/codeExtractor.js` - éªŒè¯ç æå–
```javascript
const patterns = [
    /éªŒè¯ç [ï¼š:]\s*([A-Za-z0-9]{4,8})/,
    /code[ï¼š:]\s*([A-Za-z0-9]{4,8})/i,
    /(\d{6})\s*ä¸ºæ‚¨çš„éªŒè¯ç /,
    /Your verification code is\s*([A-Za-z0-9]{4,8})/i,
    /(\d{4,8})\s*æ˜¯æ‚¨çš„éªŒè¯ç /,
    /[ã€\[]éªŒè¯ç [ã€‘\]]\s*([A-Za-z0-9]{4,8})/,
    /éªŒè¯ç ä¸º\s*([A-Za-z0-9]{4,8})/,
    /åŠ¨æ€ç [ï¼š:]\s*([A-Za-z0-9]{4,8})/,
    /verification code:\s*([A-Za-z0-9]{4,8})/i,
    /æ¿€æ´»ç [ï¼š:]\s*([A-Za-z0-9]{4,8})/
];

function extractVerificationCode(text) {
    if (!text) return null;
    
    for (const pattern of patterns) {
        const match = text.match(pattern);
        if (match) {
            return match[1];
        }
    }
    
    return null;
}

module.exports = { extractVerificationCode };
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–é¡¹ç›®

```bash
# å…‹éš†æˆ–åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir tempemail && cd tempemail

# åˆå§‹åŒ–å‰ç«¯ï¼ˆVue 3 + Viteï¼‰
npm create vite@latest frontend -- --template vue
cd frontend && npm install

# åˆå§‹åŒ–åç«¯ï¼ˆExpressï¼‰
cd ../
mkdir backend && cd backend
npm init -y
npm install express cors dotenv sqlite3 node-imap mailparser ws

# è¿”å›æ ¹ç›®å½•
cd ..
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

**å‰ç«¯ `.env`**
```env
VITE_API_BASE=http://localhost:3000/api
VITE_WS_URL=ws://localhost:3000
```

**åç«¯ `.env`**
```env
PORT=3000

# Cloudflare
CLOUDFLARE_API_TOKEN=your_api_token
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_ZONE_ID=your_zone_id
DOMAIN_NAME=yourdomain.com

# QQé‚®ç®±
QQ_EMAIL=your@qq.com
QQ_IMAP_PASSWORD=your_imap_auth_code

# æ•°æ®åº“
DATABASE_PATH=./database/tempemail.db

# ç›‘æ§
MONITOR_INTERVAL=10
AUTO_DELETE_DAYS=7
```

### 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨åç«¯
cd backend
npm run dev

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm run dev
```

---

## ğŸ“ Gitæäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œï¼‰
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
```

ç¤ºä¾‹ï¼š
```bash
git commit -m "feat: æ·»åŠ ä¸´æ—¶é‚®ç®±åˆ›å»ºåŠŸèƒ½"
git commit -m "fix: ä¿®å¤éªŒè¯ç æå–æ­£åˆ™è¡¨è¾¾å¼"
```

---

**ä¸‹ä¸€æ­¥ï¼šè¯·é€‰æ‹©å®ç°æ–¹æ¡ˆï¼Œæˆ‘å°†å¼€å§‹æ­å»ºé¡¹ç›®ï¼**

