# ä¸´æ—¶é‚®ç®±ç³»ç»Ÿ - éœ€æ±‚åˆ†ææ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäº Cloudflare Email Routing å’Œ QQ é‚®ç®±çš„ä¸´æ—¶é‚®ç®±ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨è½¬å‘ã€å®æ—¶ç›‘æ§å’ŒéªŒè¯ç æå–ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 1. ä¸´æ—¶é‚®ç®±ç®¡ç†æ¨¡å—

#### 1.1 é‚®ç®±åˆ›å»º
- **åŠŸèƒ½æè¿°**ï¼šç”¨æˆ·ç‚¹å‡»åˆ›å»ºæŒ‰é’®ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆä¸´æ—¶é‚®ç®±åœ°å€
- **å‘½åè§„åˆ™**ï¼š`temp_{éšæœºå­—ç¬¦ä¸²}@{ç”¨æˆ·åŸŸå}.com`
  - éšæœºå­—ç¬¦ä¸²ï¼š8-12ä½ï¼ŒåŒ…å«å­—æ¯+æ•°å­—
  - ç¤ºä¾‹ï¼š`temp_a7k9m2x5@yourdomain.com`
- **è‡ªåŠ¨æ“ä½œ**ï¼š
  - è°ƒç”¨ Cloudflare API åˆ›å»º Email Routing è§„åˆ™
  - è®¾ç½®ç›®æ ‡åœ°å€ä¸ºç”¨æˆ·çš„ QQ é‚®ç®±
  - è‡ªåŠ¨å¤åˆ¶é‚®ç®±åœ°å€åˆ°å‰ªè´´æ¿
  - è®°å½•åˆ›å»ºæ—¶é—´æˆ³ï¼ˆç”¨äºè¿‡æ»¤é‚®ä»¶ï¼‰

#### 1.2 æ‰¹é‡ç®¡ç†
- **é‚®ç®±åˆ—è¡¨**ï¼š
  - æ˜¾ç¤ºæ‰€æœ‰å·²åˆ›å»ºçš„ä¸´æ—¶é‚®ç®±
  - æ˜¾ç¤ºåˆ›å»ºæ—¶é—´
  - æ˜¾ç¤ºæ”¶åˆ°é‚®ä»¶æ•°é‡
  - æ˜¾ç¤ºæœ€åæ”¶ä¿¡æ—¶é—´
- **æ“ä½œåŠŸèƒ½**ï¼š
  - å•ä¸ªåˆ é™¤ï¼šåˆ é™¤é‚®ç®±åŠå…¶è½¬å‘è§„åˆ™
  - æ‰¹é‡åˆ é™¤ï¼šé€‰ä¸­å¤šä¸ªé‚®ç®±æ‰¹é‡åˆ é™¤
  - ä¸€é”®æ¸…ç©ºï¼šåˆ é™¤æ‰€æœ‰ä¸´æ—¶é‚®ç®±
  - å¤åˆ¶åœ°å€ï¼šç‚¹å‡»å³å¤åˆ¶

#### 1.3 é‚®ç®±çŠ¶æ€
- **çŠ¶æ€ç±»å‹**ï¼š
  - ğŸŸ¢ æ´»è·ƒä¸­ï¼šæœ‰è½¬å‘è§„åˆ™ï¼Œæ­£å¸¸æ¥æ”¶é‚®ä»¶
  - ğŸŸ¡ ç­‰å¾…ä¸­ï¼šå·²åˆ›å»ºï¼Œç­‰å¾…é¦–å°é‚®ä»¶
  - ğŸ”´ å·²è¿‡æœŸï¼šè¶…è¿‡è®¾å®šæ—¶é—´æˆ–æ‰‹åŠ¨åˆ é™¤

### 2. æ™ºèƒ½é‚®ä»¶ç›‘æ§æ¨¡å—

#### 2.1 å®æ—¶ç›‘æ§
- **ç›‘æ§æ–¹å¼**ï¼š
  - æ–¹æ¡ˆAï¼šé€šè¿‡ IMAP åè®®è¿æ¥ QQ é‚®ç®±ï¼ˆæ¨èï¼‰
  - æ–¹æ¡ˆBï¼šé€šè¿‡ QQ é‚®ç®± APIï¼ˆå¦‚æœå¯ç”¨ï¼‰
- **ç›‘æ§é¢‘ç‡**ï¼š
  - WebSocket å®æ—¶æ¨é€ï¼ˆå‰ç«¯è¿æ¥åç«¯ï¼‰
  - åç«¯è½®è¯¢é—´éš”ï¼š5-10ç§’
- **ç›‘æ§é€»è¾‘**ï¼š
  - åªç›‘æ§æ”¶ä»¶ç®±
  - åªå¤„ç†ä¸´æ—¶é‚®ç®±åˆ›å»ºåçš„æ–°é‚®ä»¶
  - æ£€æŸ¥å‘ä»¶åœ°å€æ˜¯å¦ä¸ºä¸´æ—¶é‚®ç®±çš„è½¬å‘

#### 2.2 éªŒè¯ç æå–
- **è¯†åˆ«è§„åˆ™**ï¼š
  ```javascript
  const patterns = [
    /éªŒè¯ç [ï¼š:]\s*([A-Za-z0-9]{4,8})/,
    /code[ï¼š:]\s*([A-Za-z0-9]{4,8})/i,
    /(\d{6})\s*ä¸ºæ‚¨çš„éªŒè¯ç /,
    /Your verification code is\s*([A-Za-z0-9]{4,8})/i,
    /(\d{4,8})\s*æ˜¯æ‚¨çš„éªŒè¯ç /,
    /[ã€\[]éªŒè¯ç [ã€‘\]]\s*([A-Za-z0-9]{4,8})/
  ];
  ```
- **æ˜¾ç¤ºæ–¹å¼**ï¼š
  - é«˜äº®æ˜¾ç¤ºéªŒè¯ç 
  - ä¸€é”®å¤åˆ¶éªŒè¯ç 
  - éªŒè¯ç å€’è®¡æ—¶ï¼ˆå¦‚æœèƒ½è¯†åˆ«æœ‰æ•ˆæœŸï¼‰

#### 2.3 æ—¶é—´è¿‡æ»¤
- **è¿‡æ»¤é€»è¾‘**ï¼š
  ```
  é‚®ä»¶æ¥æ”¶æ—¶é—´ >= ä¸´æ—¶é‚®ç®±åˆ›å»ºæ—¶é—´
  ```
- **ç¼“å­˜æœºåˆ¶**ï¼š
  - è®°å½•å·²å¤„ç†çš„é‚®ä»¶ IDï¼Œé¿å…é‡å¤å¤„ç†
  - ä½¿ç”¨ LocalStorage æˆ– Redis ç¼“å­˜

#### 2.4 çŠ¶æ€æ˜¾ç¤º
- **ç›‘æ§çŠ¶æ€**ï¼š
  - ğŸŸ¢ ç›‘æ§ä¸­ï¼šæ­£åœ¨ç›‘æ§ QQ é‚®ç®±
  - ğŸŸ¡ è¿æ¥ä¸­ï¼šæ­£åœ¨å»ºç«‹è¿æ¥
  - ğŸ”´ å·²åœæ­¢ï¼šæœªå¯åŠ¨æˆ–è¿æ¥å¤±è´¥
- **ç»Ÿè®¡ä¿¡æ¯**ï¼š
  - æ€»é‚®ç®±æ•°é‡
  - æ€»é‚®ä»¶æ•°é‡
  - éªŒè¯ç æå–æ•°é‡
  - æœ€åæ›´æ–°æ—¶é—´

### 3. å‰ç«¯ç•Œé¢æ¨¡å—

#### 3.1 ä¸»ç•Œé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: ä¸´æ—¶é‚®ç®±ç³»ç»Ÿ Logo                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚                         â”‚
â”‚  å·¦ä¾§ä¸»åŒºåŸŸ                â”‚  å³ä¾§å¹¿å‘ŠåŒºåŸŸ            â”‚
â”‚                           â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åˆ›å»ºä¸´æ—¶é‚®ç®±æŒ‰é’®     â”‚  â”‚  â”‚  å¹¿å‘Šä½ 1        â”‚  â”‚
â”‚  â”‚ [+ ç”Ÿæˆæ–°é‚®ç®±]       â”‚  â”‚  â”‚  (300x250)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç›‘æ§çŠ¶æ€é¢æ¿         â”‚  â”‚  â”‚  å¹¿å‘Šä½ 2        â”‚  â”‚
â”‚  â”‚ çŠ¶æ€: ğŸŸ¢ ç›‘æ§ä¸­      â”‚  â”‚  â”‚  (300x600)       â”‚  â”‚
â”‚  â”‚ é‚®ç®±: 3 ä¸ª           â”‚  â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ é‚®ä»¶: 12 å°          â”‚  â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚  â”‚ ä¸´æ—¶é‚®ç®±åˆ—è¡¨         â”‚  â”‚                         â”‚
â”‚  â”‚                     â”‚  â”‚                         â”‚
â”‚  â”‚ ğŸ“§ temp_abc@...     â”‚  â”‚                         â”‚
â”‚  â”‚    3å°é‚®ä»¶ | åˆ é™¤   â”‚  â”‚                         â”‚
â”‚  â”‚                     â”‚  â”‚                         â”‚
â”‚  â”‚ ğŸ“§ temp_xyz@...     â”‚  â”‚                         â”‚
â”‚  â”‚    1å°é‚®ä»¶ | åˆ é™¤   â”‚  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                           â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚  â”‚ é‚®ä»¶åˆ—è¡¨ï¼ˆå®æ—¶ï¼‰     â”‚  â”‚                         â”‚
â”‚  â”‚                     â”‚  â”‚                         â”‚
â”‚  â”‚ ğŸ“¬ éªŒè¯ç é‚®ä»¶       â”‚  â”‚                         â”‚
â”‚  â”‚    éªŒè¯ç : 123456   â”‚  â”‚                         â”‚
â”‚  â”‚    [å¤åˆ¶] [æŸ¥çœ‹]    â”‚  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                           â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 å“åº”å¼è®¾è®¡
- **æ¡Œé¢ç«¯ï¼ˆ>1200pxï¼‰**ï¼šå·¦å³åˆ†æ ï¼Œå¹¿å‘Šåœ¨å³ä¾§
- **å¹³æ¿ç«¯ï¼ˆ768-1200pxï¼‰**ï¼šå•æ ï¼Œå¹¿å‘Šåœ¨åº•éƒ¨
- **ç§»åŠ¨ç«¯ï¼ˆ<768pxï¼‰**ï¼šå•æ ï¼Œå¹¿å‘Šæ¨ªå¹…

#### 3.3 åŠ¨ç”»æ•ˆæœ
- **æ–°é‚®ä»¶åˆ°è¾¾**ï¼š
  - é¡¶éƒ¨å¼¹å‡ºé€šçŸ¥ï¼ˆç±»ä¼¼ Toastï¼‰
  - é‚®ä»¶é¡¹æ·¡å…¥åŠ¨ç”»
  - éªŒè¯ç é«˜äº®é—ªçƒæ•ˆæœ
- **åˆ›å»ºé‚®ç®±**ï¼š
  - æŒ‰é’®loadingåŠ¨ç”»
  - é‚®ç®±åœ°å€æ·¡å…¥æ•ˆæœ
  - æˆåŠŸæç¤ºåŠ¨ç”»

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### 1. æŠ€æœ¯æ ˆé€‰æ‹©

#### 1.1 å‰ç«¯æŠ€æœ¯æ ˆ
```yaml
æ¡†æ¶: Vue 3 + Vite æˆ– çº¯åŸç”Ÿ JavaScript
æ ·å¼: Tailwind CSS æˆ– åŸç”ŸCSSï¼ˆå·²æœ‰ui-gpt5.htmlåŸºç¡€ï¼‰
çŠ¶æ€ç®¡ç†: Pinia æˆ– Vuexï¼ˆå¦‚æœç”¨Vueï¼‰
å®æ—¶é€šä¿¡: WebSocket æˆ– Server-Sent Events (SSE)
HTTPå®¢æˆ·ç«¯: Axios
å·¥å…·åº“: 
  - dayjs (æ—¶é—´å¤„ç†)
  - clipboard.js (å‰ªè´´æ¿)
```

#### 1.2 åç«¯æŠ€æœ¯æ ˆ
```yaml
è¯­è¨€: Node.js (æ¨è) æˆ– Python
æ¡†æ¶: 
  - Node.js: Express.js / Fastify
  - Python: FastAPI / Flask
æ•°æ®åº“: 
  - SQLite (è½»é‡çº§ï¼Œå•æœºéƒ¨ç½²)
  - PostgreSQL (ç”Ÿäº§ç¯å¢ƒ)
  - Redis (ç¼“å­˜å’Œä»»åŠ¡é˜Ÿåˆ—)
é‚®ä»¶å¤„ç†: 
  - Node.js: node-imap, mailparser
  - Python: imaplib, email
ä»»åŠ¡é˜Ÿåˆ—: 
  - Node.js: Bull
  - Python: Celery
éƒ¨ç½²å¹³å°: Cloudflare Workers / Pages (å‰åç«¯)
```

### 2. ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚         â”‚              â”‚         â”‚             â”‚
â”‚   ç”¨æˆ·æµè§ˆå™¨ â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  å‰ç«¯åº”ç”¨     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Cloudflare â”‚
â”‚             â”‚  HTML   â”‚  (Pages)     â”‚  CDN    â”‚   Pages     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â”‚ WebSocket             â”‚ API Calls
       â”‚                       â”‚
       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åç«¯æœåŠ¡ (Workers/VPS)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  APIæœåŠ¡   â”‚  â”‚  é‚®ä»¶ç›‘æ§æœåŠ¡     â”‚  â”‚
â”‚  â”‚  - åˆ›å»ºé‚®ç®± â”‚  â”‚  - IMAPè¿æ¥      â”‚  â”‚
â”‚  â”‚  - åˆ é™¤é‚®ç®± â”‚  â”‚  - é‚®ä»¶è§£æ      â”‚  â”‚
â”‚  â”‚  - æŸ¥è¯¢åˆ—è¡¨ â”‚  â”‚  - éªŒè¯ç æå–    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                 â”‚              â”‚
â”‚         â–¼                 â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      æ•°æ®åº“ (SQLite/PostgreSQL) â”‚    â”‚
â”‚  â”‚  - ä¸´æ—¶é‚®ç®±è¡¨                   â”‚    â”‚
â”‚  â”‚  - é‚®ä»¶è®°å½•è¡¨                   â”‚    â”‚
â”‚  â”‚  - ç”¨æˆ·é…ç½®è¡¨                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚
     â”‚ Cloudflare API       â”‚ IMAP/SMTP
     â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare   â”‚      â”‚  QQé‚®ç®±      â”‚
â”‚ Email Routingâ”‚      â”‚  IMAPæœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â–²
     â”‚  è½¬å‘é‚®ä»¶             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### 1. æ•°æ®è¡¨ç»“æ„

#### 1.1 ä¸´æ—¶é‚®ç®±è¡¨ (temp_emails)
```sql
CREATE TABLE temp_emails (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email_address VARCHAR(255) UNIQUE NOT NULL,  -- ä¸´æ—¶é‚®ç®±åœ°å€
    cloudflare_rule_id VARCHAR(100),              -- Cloudflareè§„åˆ™ID
    target_email VARCHAR(255) NOT NULL,           -- ç›®æ ‡QQé‚®ç®±
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- åˆ›å»ºæ—¶é—´
    last_received_at TIMESTAMP,                   -- æœ€åæ”¶ä¿¡æ—¶é—´
    email_count INTEGER DEFAULT 0,                -- æ”¶åˆ°é‚®ä»¶æ•°é‡
    status VARCHAR(20) DEFAULT 'active',          -- active/inactive/deleted
    INDEX idx_email (email_address),
    INDEX idx_status (status),
    INDEX idx_created (created_at)
);
```

#### 1.2 é‚®ä»¶è®°å½•è¡¨ (emails)
```sql
CREATE TABLE emails (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    temp_email_id INTEGER NOT NULL,               -- å…³è”ä¸´æ—¶é‚®ç®±ID
    message_id VARCHAR(255) UNIQUE,               -- é‚®ä»¶å”¯ä¸€ID
    sender VARCHAR(255),                          -- å‘ä»¶äºº
    subject TEXT,                                 -- ä¸»é¢˜
    body_text TEXT,                               -- çº¯æ–‡æœ¬å†…å®¹
    body_html TEXT,                               -- HTMLå†…å®¹
    verification_code VARCHAR(50),                -- æå–çš„éªŒè¯ç 
    received_at TIMESTAMP,                        -- æ¥æ”¶æ—¶é—´
    is_read BOOLEAN DEFAULT FALSE,                -- æ˜¯å¦å·²è¯»
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (temp_email_id) REFERENCES temp_emails(id),
    INDEX idx_temp_email (temp_email_id),
    INDEX idx_message (message_id),
    INDEX idx_received (received_at)
);
```

#### 1.3 ç”¨æˆ·é…ç½®è¡¨ (user_config)
```sql
CREATE TABLE user_config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    config_key VARCHAR(100) UNIQUE NOT NULL,      -- é…ç½®é”®
    config_value TEXT,                            -- é…ç½®å€¼
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- é»˜è®¤é…ç½®é¡¹
INSERT INTO user_config (config_key, config_value) VALUES
    ('cloudflare_api_token', ''),
    ('cloudflare_account_id', ''),
    ('cloudflare_zone_id', ''),
    ('domain_name', ''),
    ('target_qq_email', ''),
    ('qq_imap_password', ''),
    ('monitor_interval', '10'),
    ('auto_delete_days', '7');
```

---

## ğŸ”Œ API æ¥å£è®¾è®¡

### 1. RESTful API åˆ—è¡¨

#### 1.1 ä¸´æ—¶é‚®ç®±ç®¡ç†

**åˆ›å»ºä¸´æ—¶é‚®ç®±**
```http
POST /api/emails/create
Content-Type: application/json

Response:
{
    "success": true,
    "data": {
        "id": 1,
        "email": "temp_a7k9m2x5@yourdomain.com",
        "created_at": "2025-10-14T10:30:00Z",
        "copied": true
    }
}
```

**è·å–é‚®ç®±åˆ—è¡¨**
```http
GET /api/emails/list

Response:
{
    "success": true,
    "data": [
        {
            "id": 1,
            "email": "temp_a7k9m2x5@yourdomain.com",
            "created_at": "2025-10-14T10:30:00Z",
            "email_count": 3,
            "last_received_at": "2025-10-14T11:00:00Z",
            "status": "active"
        }
    ]
}
```

**åˆ é™¤ä¸´æ—¶é‚®ç®±**
```http
DELETE /api/emails/:id

Response:
{
    "success": true,
    "message": "é‚®ç®±å·²åˆ é™¤"
}
```

**æ‰¹é‡åˆ é™¤**
```http
POST /api/emails/batch-delete
Content-Type: application/json

{
    "ids": [1, 2, 3]
}

Response:
{
    "success": true,
    "deleted_count": 3
}
```

#### 1.2 é‚®ä»¶ç®¡ç†

**è·å–é‚®ä»¶åˆ—è¡¨**
```http
GET /api/emails/:temp_email_id/messages?page=1&limit=20

Response:
{
    "success": true,
    "data": {
        "messages": [
            {
                "id": 1,
                "sender": "noreply@example.com",
                "subject": "éªŒè¯ç é€šçŸ¥",
                "verification_code": "123456",
                "received_at": "2025-10-14T11:00:00Z",
                "is_read": false
            }
        ],
        "pagination": {
            "page": 1,
            "limit": 20,
            "total": 45
        }
    }
}
```

**è·å–é‚®ä»¶è¯¦æƒ…**
```http
GET /api/messages/:id

Response:
{
    "success": true,
    "data": {
        "id": 1,
        "sender": "noreply@example.com",
        "subject": "éªŒè¯ç é€šçŸ¥",
        "body_html": "<html>...</html>",
        "body_text": "æ‚¨çš„éªŒè¯ç æ˜¯ï¼š123456",
        "verification_code": "123456",
        "received_at": "2025-10-14T11:00:00Z"
    }
}
```

#### 1.3 ç³»ç»Ÿé…ç½®

**è·å–é…ç½®**
```http
GET /api/config

Response:
{
    "success": true,
    "data": {
        "domain_name": "yourdomain.com",
        "target_qq_email": "your***@qq.com",
        "monitor_status": "running",
        "monitor_interval": 10
    }
}
```

**æ›´æ–°é…ç½®**
```http
PUT /api/config
Content-Type: application/json

{
    "cloudflare_api_token": "xxx",
    "target_qq_email": "xxx@qq.com",
    "qq_imap_password": "xxx"
}

Response:
{
    "success": true,
    "message": "é…ç½®å·²æ›´æ–°"
}
```

#### 1.4 ç›‘æ§çŠ¶æ€

**è·å–ç›‘æ§çŠ¶æ€**
```http
GET /api/monitor/status

Response:
{
    "success": true,
    "data": {
        "status": "running",
        "total_emails": 5,
        "total_messages": 23,
        "verification_codes_extracted": 18,
        "last_check_at": "2025-10-14T11:05:00Z"
    }
}
```

**å¯åŠ¨/åœæ­¢ç›‘æ§**
```http
POST /api/monitor/toggle
Content-Type: application/json

{
    "action": "start" // or "stop"
}

Response:
{
    "success": true,
    "status": "running"
}
```

### 2. WebSocket å®æ—¶æ¨é€

**è¿æ¥åœ°å€**
```
ws://localhost:3000/ws
æˆ–
wss://yourdomain.com/ws
```

**æ¶ˆæ¯æ ¼å¼**

æ–°é‚®ä»¶é€šçŸ¥ï¼š
```json
{
    "type": "new_email",
    "data": {
        "temp_email": "temp_a7k9m2x5@yourdomain.com",
        "message": {
            "id": 1,
            "sender": "noreply@example.com",
            "subject": "éªŒè¯ç é€šçŸ¥",
            "verification_code": "123456",
            "received_at": "2025-10-14T11:00:00Z"
        }
    }
}
```

ç›‘æ§çŠ¶æ€æ›´æ–°ï¼š
```json
{
    "type": "monitor_status",
    "data": {
        "status": "running",
        "last_check_at": "2025-10-14T11:05:00Z"
    }
}
```

---

## ğŸ” å®‰å…¨è€ƒè™‘

### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- âœ… API Tokenã€é‚®ç®±å¯†ç ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨
- âœ… æ•°æ®åº“ä¸­æ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨
- âœ… å‰ç«¯ä¸å±•ç¤ºå®Œæ•´çš„é…ç½®ä¿¡æ¯

### 2. è®¿é—®æ§åˆ¶
- âœ… å¯é€‰ï¼šæ·»åŠ ç®€å•çš„å¯†ç ä¿æŠ¤
- âœ… é™åˆ¶ API è°ƒç”¨é¢‘ç‡ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- âœ… Cloudflare Workers æä¾› DDoS é˜²æŠ¤

### 3. æ•°æ®å®‰å…¨
- âœ… å®šæœŸæ¸…ç†è¿‡æœŸé‚®ä»¶ï¼ˆé»˜è®¤7å¤©ï¼‰
- âœ… é™åˆ¶ä¸´æ—¶é‚®ç®±æ•°é‡ï¼ˆé¿å…æ»¥ç”¨ Cloudflare APIï¼‰
- âœ… é‚®ä»¶å†…å®¹ä¸æ°¸ä¹…å­˜å‚¨

---

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šCloudflare å…¨æ ˆéƒ¨ç½²ï¼ˆæ¨èï¼‰

```
å‰ç«¯ï¼šCloudflare Pages
åç«¯ï¼šCloudflare Workers
æ•°æ®åº“ï¼šCloudflare D1 (SQLite)
KVå­˜å‚¨ï¼šCloudflare KVï¼ˆç¼“å­˜ï¼‰
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨å…è´¹ï¼ˆåœ¨é…é¢å†…ï¼‰
- âœ… å…¨çƒCDNåŠ é€Ÿ
- âœ… è‡ªåŠ¨HTTPS
- âœ… éƒ¨ç½²ç®€å•

**é™åˆ¶**ï¼š
- âš ï¸ Workers CPUæ—¶é—´é™åˆ¶
- âš ï¸ IMAPè¿æ¥å¯èƒ½éœ€è¦å¤–éƒ¨æœåŠ¡

### æ–¹æ¡ˆ Bï¼šæ··åˆéƒ¨ç½²

```
å‰ç«¯ï¼šCloudflare Pages
åç«¯APIï¼šCloudflare Workers
é‚®ä»¶ç›‘æ§ï¼šVPSï¼ˆNode.js/Pythonï¼‰
æ•°æ®åº“ï¼šVPSï¼ˆPostgreSQLï¼‰
```

**ä¼˜ç‚¹**ï¼š
- âœ… å‰ç«¯å…¨çƒåŠ é€Ÿ
- âœ… é‚®ä»¶ç›‘æ§æ›´ç¨³å®š
- âœ… æ•°æ®åº“æ€§èƒ½æ›´å¥½

### æ–¹æ¡ˆ Cï¼šä¼ ç»Ÿ VPS éƒ¨ç½²

```
å‰ç«¯+åç«¯ï¼šVPSï¼ˆNginx + Node.js/Pythonï¼‰
æ•°æ®åº“ï¼šåŒVPSæˆ–äº‘æ•°æ®åº“
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨æ§åˆ¶
- âœ… æ— é™åˆ¶
- âœ… éƒ¨ç½²çµæ´»

---

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆMVPï¼‰
1. âœ… åˆ›å»ºå‰ç«¯UIï¼ˆå·²å®Œæˆ ui-gpt5.htmlï¼‰
2. â¬œ æ­å»ºåç«¯æ¡†æ¶
3. â¬œ å®ç° Cloudflare API é›†æˆ
4. â¬œ å®ç°ä¸´æ—¶é‚®ç®±åˆ›å»º/åˆ é™¤
5. â¬œ æ•°æ®åº“è®¾è®¡ä¸å®ç°

### é˜¶æ®µ 2ï¼šé‚®ä»¶ç›‘æ§
1. â¬œ QQé‚®ç®± IMAP è¿æ¥
2. â¬œ é‚®ä»¶è§£æä¸å­˜å‚¨
3. â¬œ éªŒè¯ç æå–é€»è¾‘
4. â¬œ WebSocket å®æ—¶æ¨é€

### é˜¶æ®µ 3ï¼šä¼˜åŒ–å®Œå–„
1. â¬œ å“åº”å¼è®¾è®¡ä¼˜åŒ–
2. â¬œ åŠ¨ç”»æ•ˆæœä¼˜åŒ–
3. â¬œ å¹¿å‘Šä½é›†æˆ
4. â¬œ æ€§èƒ½ä¼˜åŒ–

### é˜¶æ®µ 4ï¼šéƒ¨ç½²ä¸Šçº¿
1. â¬œ ç¯å¢ƒé…ç½®
2. â¬œ Cloudflare é…ç½®
3. â¬œ åŸŸåç»‘å®š
4. â¬œ æµ‹è¯•ä¸å‘å¸ƒ

---

## ğŸ“Š å…³é”®æŠ€æœ¯å®ç°

### 1. Cloudflare Email Routing API

**åˆ›å»ºè½¬å‘è§„åˆ™**
```javascript
async function createEmailRule(emailAddress, targetEmail) {
    const response = await fetch(
        `https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/email/routing/rules`,
        {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${API_TOKEN}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                matchers: [{
                    type: 'literal',
                    field: 'to',
                    value: emailAddress
                }],
                actions: [{
                    type: 'forward',
                    value: [targetEmail]
                }],
                enabled: true,
                name: `Temp Email: ${emailAddress}`
            })
        }
    );
    return await response.json();
}
```

**åˆ é™¤è½¬å‘è§„åˆ™**
```javascript
async function deleteEmailRule(ruleId) {
    const response = await fetch(
        `https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/email/routing/rules/${ruleId}`,
        {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${API_TOKEN}`
            }
        }
    );
    return await response.json();
}
```

### 2. QQé‚®ç®± IMAP ç›‘æ§

**Node.js ç¤ºä¾‹**
```javascript
const Imap = require('node-imap');
const { simpleParser } = require('mailparser');

const imap = new Imap({
    user: 'your@qq.com',
    password: 'your_imap_password', // æˆæƒç 
    host: 'imap.qq.com',
    port: 993,
    tls: true
});

function monitorEmails(sinceDate) {
    imap.once('ready', () => {
        imap.openBox('INBOX', false, (err, box) => {
            if (err) throw err;
            
            // æœç´¢æŒ‡å®šæ—¶é—´åçš„é‚®ä»¶
            imap.search([['SINCE', sinceDate]], (err, results) => {
                if (err) throw err;
                
                const f = imap.fetch(results, { bodies: '' });
                
                f.on('message', (msg) => {
                    msg.on('body', (stream) => {
                        simpleParser(stream, async (err, parsed) => {
                            // å¤„ç†é‚®ä»¶
                            const verificationCode = extractVerificationCode(parsed.text);
                            // ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ¨é€åˆ°å‰ç«¯
                        });
                    });
                });
            });
        });
    });
    
    imap.connect();
}
```

### 3. éªŒè¯ç æå–

```javascript
function extractVerificationCode(text) {
    const patterns = [
        /éªŒè¯ç [ï¼š:]\s*([A-Za-z0-9]{4,8})/,
        /code[ï¼š:]\s*([A-Za-z0-9]{4,8})/i,
        /(\d{6})\s*ä¸ºæ‚¨çš„éªŒè¯ç /,
        /Your verification code is\s*([A-Za-z0-9]{4,8})/i,
        /(\d{4,8})\s*æ˜¯æ‚¨çš„éªŒè¯ç /,
        /[ã€\[]éªŒè¯ç [ã€‘\]]\s*([A-Za-z0-9]{4,8})/,
        /éªŒè¯ç ä¸º\s*([A-Za-z0-9]{4,8})/,
        /åŠ¨æ€ç [ï¼š:]\s*([A-Za-z0-9]{4,8})/
    ];
    
    for (const pattern of patterns) {
        const match = text.match(pattern);
        if (match) {
            return match[1];
        }
    }
    
    return null;
}
```

---

## ğŸ’° æˆæœ¬é¢„ä¼°

### å…è´¹æ–¹æ¡ˆï¼ˆCloudflareï¼‰
- Cloudflare Pages: å…è´¹
- Cloudflare Workers: 100,000 è¯·æ±‚/å¤©ï¼ˆå…è´¹ï¼‰
- Cloudflare Email Routing: å…è´¹ï¼ˆ200æ¡è§„åˆ™ï¼‰
- **æ€»æˆæœ¬ï¼š$0/æœˆ**

### VPS æ–¹æ¡ˆ
- è½»é‡VPSï¼š$5-10/æœˆ
- åŸŸåï¼š$10-15/å¹´
- **æ€»æˆæœ¬ï¼šçº¦ $60-135/å¹´**

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç¡®è®¤æŠ€æœ¯æ ˆ**ï¼šé€‰æ‹©å‰ç«¯æ¡†æ¶ï¼ˆVue 3 æˆ– çº¯JSï¼‰å’Œåç«¯æ¡†æ¶
2. **ç¡®è®¤éƒ¨ç½²æ–¹æ¡ˆ**ï¼šCloudflareå…¨æ ˆ æˆ– æ··åˆéƒ¨ç½²
3. **å¼€å§‹ç¼–ç **ï¼š
   - å…ˆå®ç°åç«¯API
   - é›†æˆ Cloudflare API
   - å®Œå–„å‰ç«¯åŠŸèƒ½
   - å®ç°é‚®ä»¶ç›‘æ§

---

è¯·å‘ŠçŸ¥æ‚¨çš„å€¾å‘ï¼š
1. æŠ€æœ¯æ ˆåå¥½ï¼ˆNode.js è¿˜æ˜¯ Pythonï¼ŸVue è¿˜æ˜¯çº¯JSï¼Ÿï¼‰
2. éƒ¨ç½²æ–¹æ¡ˆåå¥½ï¼ˆå…¨Cloudflare è¿˜æ˜¯æ··åˆéƒ¨ç½²ï¼Ÿï¼‰
3. æ˜¯å¦éœ€è¦æˆ‘å¼€å§‹ç¼–å†™åç«¯ä»£ç ï¼Ÿ

